---
title: 'Riverpodã§çŠ¶æ…‹ç®¡ç†'
description: 'ãƒãƒ£ãƒƒãƒˆã‚¢ãƒ—ãƒªã§Riverpodã‚’ä½¿ã£ãŸçŠ¶æ…‹ç®¡ç†ã‚’å®Ÿè£…ã™ã‚‹æ–¹æ³•ã‚’ç´¹ä»‹'
next: host-web-app/hosting
slug: firebase-app-06
---

## ã“ã®ãƒšãƒ¼ã‚¸ã®ã‚´ãƒ¼ãƒ«

- Riverpodã®æ¦‚è¦ã¨ä½¿ã„æ–¹ã‚’çŸ¥ã‚‹
- Riverpodã‚’ä½¿ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’ç®¡ç†ã™ã‚‹


## ãƒãƒ£ãƒƒãƒˆã‚¢ãƒ—ãƒªå…¨ä½“åƒ

### æ©Ÿèƒ½ä¸€è¦§

- âœ¨ ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒ»ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§ãƒ­ã‚°ã‚¤ãƒ³ã§ãã‚‹
- âœ¨ ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã§ãã‚‹
- âœ¨ ãƒãƒ£ãƒƒãƒˆã®æŠ•ç¨¿ä¸€è¦§ã‚’è¡¨ç¤ºã§ãã‚‹
- âœ¨ ãƒãƒ£ãƒƒãƒˆã«æŠ•ç¨¿ã§ãã‚‹
- âœ¨ ãƒãƒ£ãƒƒãƒˆã®æŠ•ç¨¿ã‚’å‰Šé™¤ã§ãã‚‹

### ã‚¤ãƒ¡ãƒ¼ã‚¸å›³

![](/images/firebase-app/about-firebase-app.svg)

### â—ï¸ æ³¨æ„äº‹é … â—ï¸

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ»é››å½¢ã®ä½œæˆãŒçµ‚ã‚ã£ã¦ã„ãªã„å ´åˆã¯  
[Firebaseã‚’ä½¿ã£ãŸã‚¢ãƒ—ãƒªæ¦‚è¦](/firebase-app/about-firebase-app)ã®ãƒšãƒ¼ã‚¸ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚


## çŠ¶æ…‹ç®¡ç†

### çŠ¶æ…‹ç®¡ç†ã¨ã¯

ã¾ãšã¯çŠ¶æ…‹ç®¡ç†ã¨ã¯ä½•ã§ã‚ã‚‹ã‹ã«ã¤ã„ã¦ç†è§£ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

[Widgetã¨ã¯](/widgets/about-widget)ã§ã¯ã€  
Flutterã¯**Widgetã‚’ãƒ„ãƒªãƒ¼çŠ¶ã«çµ„ã¿åˆã‚ã›UIã‚’å®Ÿç¾**ã™ã‚‹ã“ã¨ã‚’ç´¹ä»‹ã—ã¾ã—ãŸã­ã€‚

ãã—ã¦ã€[çŠ¶æ…‹ã‚’æŒã£ãŸWidget](/widgets/state-widget)ã§ã¯ã€  
**ãƒ‡ãƒ¼ã‚¿ã‚’å…ƒã«UIã‚’ä½œã‚‹**ä»•çµ„ã¿ã®ã“ã¨ã‚’**çŠ¶æ…‹ã‚’æŒã¤**ã¨å‘¼ã¶ã“ã¨ã‚’ç´¹ä»‹ã—ã¾ã—ãŸã­ã€‚


<table>
    <thead>
        <tr>
            <th>Widgetã‚’ãƒ„ãƒªãƒ¼çŠ¶ã«çµ„ã¿åˆã‚ã›UIã‚’å®Ÿç¾</th>
            <th>ãƒ‡ãƒ¼ã‚¿ã‚’å…ƒã«UIã‚’ä½œã‚‹</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td width="40%"><img src="/images/about-widget.svg" /></td>
            <td width="60%"><img src="/images/state-widget.svg" /></td>
        </tr>
    </tbody>
</table>


ã“ã‚Œã‚‰ã®çŸ¥è­˜ã‚’çµ„ã¿åˆã‚ã›ã‚‹ã¨ã€  
**æ§˜ã€…ãªãƒ‡ãƒ¼ã‚¿ã‚’å…ƒã«ã‚¢ãƒ—ãƒªã®UIã‚’ä½œã£ã¦ã„ã‚‹**ã®ã§ã™ã€‚

**æ§˜ã€…ãªãƒ‡ãƒ¼ã‚¿**ã®ã“ã¨ã‚’**ã‚¢ãƒ—ãƒªã®çŠ¶æ…‹**ã¨å‘¼ã³ã€  
ãã®**çŠ¶æ…‹ã‚’æ‰±ã„ã‚„ã™ãç®¡ç†ã™ã‚‹ä»•çµ„ã¿**ã®ã“ã¨ã‚’**çŠ¶æ…‹ç®¡ç†**ã¨è¨€ã†ã®ã§ã™ã€‚

çŠ¶æ…‹ç®¡ç†ã‚’è¡Œã£ã¦ã„ãªã„ã¨ãƒ‡ãƒ¼ã‚¿ã®æ‰±ã„ãŒè¤‡é›‘ã«ãªã‚Šã€  
ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’æ›¸ãã®ãŒå¤§å¤‰ã«ãªã£ã¦ã—ã¾ã†ã§ã—ã‚‡ã† ğŸ˜¨ğŸ˜¨ğŸ˜¨

![](/images/provider/app-state.svg)


### Riverpod

[çŠ¶æ…‹ã‚’æŒã£ãŸWidget](/widgets/state-widget)ã§ã‚‚ç´¹ä»‹ã—ãŸã‚ˆã†ã«ã€  
`StatefulWidget` ã¨ `State` ã‚’ä½¿ãˆã°çŠ¶æ…‹ã‚’å…ƒã«UIã‚’ä½œã‚‹ã“ã¨ã¯å¯èƒ½ã§ã™ã€‚

ã§ã™ãŒã€æ§˜ã€…ãªWidgetãŒçµ„ã¿åˆã‚ã•ã£ãŸUIã«ãªã‚Šã€  
**çŠ¶æ…‹ãŒè¤‡é›‘ã«ãªã£ã¦ã—ã¾ã†ã¨ã€ç®¡ç†ã—ãã‚Œãªããªã£ã¦ã—ã¾ã†**ã®ã§ã™ã€‚

ãã“ã§ã€ç™»å ´ã™ã‚‹ã®ãŒ `riverpod` ã§ã™ã€‚

- https://pub.dev/packages/flutter_riverpod

ã“ã‚Œã‚’ä½¿ã†ã“ã¨ã§**è¤‡é›‘ãªçŠ¶æ…‹ã‚‚ç°¡å˜ã«ç®¡ç†ã™ã‚‹ã“ã¨ãŒã§ãã‚‹**ã®ã§ã™ã€‚


## Riverpodã®ä½¿ã„æ–¹

æ¬¡ã¯ã€Riverpodã®åŸºæœ¬çš„ãªä½¿ã„æ–¹ã‚’ç´¹ä»‹ã—ã¦ã„ãã¾ã™ã€‚

### Riverpodã§å‡ºæ¥ã‚‹ã“ã¨

ã§ã¯ã€Riverpodã‚’ä½¿ã†ã¨å…·ä½“çš„ã«ã¯ä½•ãŒå‡ºæ¥ã‚‹ã®ã§ã—ã‚‡ã†ã‹ï¼Ÿ

ã¨ã¦ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ã§**ä»»æ„ã®Widgetã«ãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘æ¸¡ã™**ã“ã¨ãŒå‡ºæ¥ã‚‹ã®ã§ã™ã€‚  

![](/images/firebase-app/riverpod-state.svg)

### ãƒ‡ãƒ¼ã‚¿ã®å—ã‘æ¸¡ã—

åŸºæœ¬çš„ãªãƒ‡ãƒ¼ã‚¿ã®å—ã‘æ¸¡ã—æ–¹æ³•ã‚’ç¢ºèªã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚  
ä½¿ã„æ–¹ã¯ç°¡å˜ã§ã€è¦ªWidgetã¨å­Widgetã§ãƒ‡ãƒ¼ã‚¿ã®å—ã‘æ¸¡ã—ç”¨ã®å‡¦ç†ã‚’è¿½åŠ ã™ã‚‹ã ã‘ã§è‰¯ã„ã®ã§ã™ã€‚

è§£èª¬

- æœ€åˆã®Widgetã‚’ `ProviderScope()` ã®å­Widgetã¨ã—ã€ãƒ‡ãƒ¼ã‚¿ã®å—ã‘æ¸¡ã—ãŒå¯èƒ½ãªçŠ¶æ…‹ã«ã™ã‚‹
- `StateProvider` ã‚’ä½¿ã„**å—ã‘æ¸¡ã™ãƒ‡ãƒ¼ã‚¿ã‚’å®šç¾©ã™ã‚‹**
- `ConsumerWidget` ã‚’ä½¿ã„**ãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚‹**

ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰

```dart
import 'package:flutter/material.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';

// StateProviderã‚’ä½¿ã„å—ã‘æ¸¡ã™ãƒ‡ãƒ¼ã‚¿ã‚’å®šç¾©ã™ã‚‹
// â€» Providerã®ç¨®é¡ã¯è¤‡æ•°ã‚ã‚‹ãŒã€ã“ã“ã§ã¯ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ã§ãã‚‹StateProviderã‚’ä½¿ã†
final countProvider = StateProvider((ref) {
  return 0;
});

void main() {
  runApp(
    // Riverpodã§ãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘æ¸¡ã—ãŒå¯èƒ½ãªçŠ¶æ…‹ã«ã™ã‚‹ãŸã‚ã«å¿…è¦
    ProviderScope(
      child: MaterialApp(
        title: 'Flutter Demo',
        home: MyWidget(),
      ),
    ),
  );
}

// ConsumerWidgetã‚’ä½¿ã†ã¨build()ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚‹äº‹ãŒã§ãã‚‹
class MyWidget extends ConsumerWidget {
  @override
  Widget build(BuildContext context, ScopedReader watch) {
    // watch()ã‚’ä½¿ã„ãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚‹
    // å€¤ã¯.stateã«å…¥ã£ã¦ã„ã‚‹
    final count = watch(countProvider).state;

    return Scaffold(
      body: Center(
        child: Text('count is $count'),
      ),
    );
  }
}
```

### å—ã‘æ¸¡ã™ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ã™ã‚‹

å—ã‘æ¸¡ã™ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ã™ã‚‹æ–¹æ³•ã‚‚ç¢ºèªã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

ã“ã¡ã‚‰ã‚‚é›£ã—ã„ã“ã¨ã¯ãªãã€  
`context.read(countProvider).state` ã«æ›´æ–°ã—ãŸã„å€¤ã‚’ä»£å…¥ã™ã‚Œã°OKã§ã™ã€‚

è§£èª¬

- `context.read(countProvider).state += 1;` ã®æ§˜ã«æ›´æ–°ã—ãŸã„å€¤ã‚’ä»£å…¥ã™ã‚Œã°OK
- æ›´æ–°ã•ã‚ŒãŸå€¤ã¯è‡ªå‹•çš„ã«åæ˜ ã•ã‚Œã‚‹

ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰

```dart
import 'package:flutter/material.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';

final countProvider = StateProvider((ref) {
  return 0;
});

void main() {
  runApp(
    ProviderScope(
      child: MyApp(),
    ),
  );
}

class MyApp extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      title: 'Flutter Demo',
      home: SampleWidget(),
    );
  }
}

class SampleWidget extends ConsumerWidget {
  @override
  Widget build(BuildContext context, ScopedReader watch) {
    // å€¤ãŒæ›´æ–°ã•ã‚ŒãŸã‚‰è‡ªå‹•çš„ã«åæ˜ ã•ã‚Œã‚‹
    final count = watch(countProvider).state;

    return Scaffold(
      body: Center(
        child: Text('count is $count'),
      ),
      floatingActionButton: FloatingActionButton(
        onPressed: () {
          // context.read(countProvider).state ã«å€¤ã‚’ä»£å…¥ã™ã‚‹ã“ã¨ã§æ›´æ–°ã§ãã‚‹
          // ã¾ãŸã€ãƒœã‚¿ãƒ³ã‚¿ãƒƒãƒ—æ™‚ãªã©ã¯ context.read() ã‚’ä½¿ã†ã“ã¨ã§ç„¡é§„ãªå†æç”»ã‚’æ¸›ã‚‰ã›ã‚‹
          context.read(countProvider).state += 1;
        },
        child: Icon(Icons.add),
      ),
    );
  }
}
```

### riverpodã¨providerã©ã¡ã‚‰ã‚’ä½¿ã£ãŸã»ã†ãŒè‰¯ã„ã®ã‹ï¼Ÿ

1ã¤å‰ã§ç´¹ä»‹ã—ãŸ `provider` ã§ã‚‚çŠ¶æ…‹ç®¡ç†ã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚  
ã§ã¯ã€ã©ã¡ã‚‰ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ã£ã¦çŠ¶æ…‹ç®¡ç†ã‚’è¡Œã£ãŸã»ã†ãŒè‰¯ã„ã®ã§ã—ã‚‡ã†ã‹ ğŸ¤”

`provider`, `riverpod` å…±ã«åŒã˜æ–¹ãŒãƒ¡ã‚¤ãƒ³ã§é–‹ç™ºã—ã¦ã„ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§ã™ã€‚  
ã¾ãŸã€`riverpod` ã¯ `provider` ã®èª²é¡Œç‚¹ã‚’è§£æ¶ˆã—ãŸå¾Œç¶™ã¨ãªã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§ã‚‚ã‚ã‚Šã¾ã™ã€‚

ã§ã™ã®ã§ã€ä»Šå¾Œã¯ `riverpod` ã‚’æ¡ç”¨ã—ã¦ãŠã„ãŸã»ã†ãŒè‰¯ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚  
â€» `provider` ã‚’æ¡ç”¨ã™ã‚‹ã“ã¨è‡ªä½“ã«å•é¡Œã¯ãªã„ã®ã§ã€`provider`ã®æ–¹ãŒä½¿ã„ã‚„ã™ã‘ã‚Œã°ãã®ã¾ã¾ä½¿ã„ç¶šã‘ã¦ã‚‚OKã§ã™ ğŸ‘


## Riverpodã§ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’ç®¡ç†ã™ã‚‹

Riverpodã®ä»•çµ„ã¿ã‚„ä½¿ã„æ–¹ã¯ç†è§£ã§ããŸã§ã—ã‚‡ã†ã‹ ğŸ¤”  
ãã‚Œã§ã¯ã€Riverpodã‚’ä½¿ã„ãƒãƒ£ãƒƒãƒˆã‚¢ãƒ—ãƒªã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’ç®¡ç†ã—ã¦ã¿ã¾ã—ã‚‡ã† ğŸ’ª

### Riverpodã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

Riverpodã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã—ã‚‡ã†ã€‚

- https://pub.dev/packages/flutter_riverpod

ä½œæˆã—ãŸFlutterãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã® `pubspec.yaml` ã‚’é–‹ãã€  
`dependencies` ã«ä½¿ç”¨ã™ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’è¿½è¨˜ã—ã¾ã™ã€‚

```yaml
# --- çœç•¥ ---

dependencies:
  flutter:
    sdk: flutter
  cupertino_icons: ^1.0.3
  firebase_core: ^1.0.1
  firebase_auth: ^1.0.1
  cloud_firestore: ^1.0.1
  # *** ã“ã“ã‚’è¿½è¨˜ ***
  flutter_riverpod: ^0.14.0+3

dev_dependencies:
  flutter_test:
    sdk: flutter

# --- çœç•¥ ---
```

VSCodeã®Flutterãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½¿ã£ã¦ã„ã‚‹å ´åˆã¯ã€  
ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ã™ã‚Œã° `pubspec.yaml` ã‚’å…ƒã«è‡ªå‹•çš„ã«ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãã‚Œã‚‹ã¯ãšã§ã™ã€‚

ã‚‚ã—ã€ä¸Šæ‰‹ãã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãã‚Œãªã„å ´åˆã¯ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ã‚‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã¾ã™ã€‚

```bash
$ flutter pub get
```

### ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ãƒ»å…¥åŠ›æƒ…å ±ãƒ»ã‚¨ãƒ©ãƒ¼æƒ…å ±ã‚’ç®¡ç†ã™ã‚‹

ã‚ã¨å°‘ã—ã§ã™ã€é ‘å¼µã£ã¦ã„ãã¾ã—ã‚‡ã† ğŸ’ª

Riverpodã‚’ä½¿ã£ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®å—ã‘æ¸¡ã—ã‚’è¡Œã„ã¾ã—ã‚‡ã†ã€‚  
`lib/main.dart` ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«æ›¸ãæ›ãˆã¾ã—ã‚‡ã†ã€‚

è§£èª¬

- `StateProvider` ã‚’ä½¿ã„å¤‰æ›´å¯èƒ½ãªãƒ‡ãƒ¼ã‚¿ã‚’æ¸¡ã™
- `StreamProvider` ã‚’ä½¿ã„Streamã‚‚æ‰±ã†ã“ã¨ãŒã§ãã‚‹
- `.autoDispose` ã‚’ä»˜ã‘ã‚‹ã“ã¨ã§å€¤ã‚’è‡ªå‹•çš„ã«ãƒªã‚»ãƒƒãƒˆã§ãã‚‹
- å¼•æ•°ã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’æ¸¡ã™å‡¦ç†ãŒä¸è¦ã«ãªã£ãŸ ğŸ¤©

ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰

```dart
import 'package:cloud_firestore/cloud_firestore.dart';
import 'package:firebase_auth/firebase_auth.dart';
import 'package:firebase_core/firebase_core.dart';
import 'package:flutter/material.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';

// ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®å—ã‘æ¸¡ã—ã‚’è¡Œã†ãŸã‚ã®Provider
final userProvider = StateProvider((ref) {
  return FirebaseAuth.instance.currentUser;
});

// ã‚¨ãƒ©ãƒ¼æƒ…å ±ã®å—ã‘æ¸¡ã—ã‚’è¡Œã†ãŸã‚ã®Provider
// â€» autoDisposeã‚’ä»˜ã‘ã‚‹ã“ã¨ã§è‡ªå‹•çš„ã«å€¤ã‚’ãƒªã‚»ãƒƒãƒˆã§ãã¾ã™
final infoTextProvider = StateProvider.autoDispose((ref) {
  return '';
});

// ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®å—ã‘æ¸¡ã—ã‚’è¡Œã†ãŸã‚ã®Provider
// â€» autoDisposeã‚’ä»˜ã‘ã‚‹ã“ã¨ã§è‡ªå‹•çš„ã«å€¤ã‚’ãƒªã‚»ãƒƒãƒˆã§ãã¾ã™
final emailProvider = StateProvider.autoDispose((ref) {
  return '';
});

// ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®å—ã‘æ¸¡ã—ã‚’è¡Œã†ãŸã‚ã®Provider
// â€» autoDisposeã‚’ä»˜ã‘ã‚‹ã“ã¨ã§è‡ªå‹•çš„ã«å€¤ã‚’ãƒªã‚»ãƒƒãƒˆã§ãã¾ã™
final passwordProvider = StateProvider.autoDispose((ref) {
  return '';
});

// ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å—ã‘æ¸¡ã—ã‚’è¡Œã†ãŸã‚ã®Provider
// â€» autoDisposeã‚’ä»˜ã‘ã‚‹ã“ã¨ã§è‡ªå‹•çš„ã«å€¤ã‚’ãƒªã‚»ãƒƒãƒˆã§ãã¾ã™
final messageTextProvider = StateProvider.autoDispose((ref) {
  return '';
});

// StreamProviderã‚’ä½¿ã†ã“ã¨ã§Streamã‚‚æ‰±ã†ã“ã¨ãŒã§ãã‚‹
// â€» autoDisposeã‚’ä»˜ã‘ã‚‹ã“ã¨ã§è‡ªå‹•çš„ã«å€¤ã‚’ãƒªã‚»ãƒƒãƒˆã§ãã¾ã™
final postsQueryProvider = StreamProvider.autoDispose((ref) {
  return FirebaseFirestore.instance
      .collection('posts')
      .orderBy('date')
      .snapshots();
});

void main() async {
  WidgetsFlutterBinding.ensureInitialized();
  await Firebase.initializeApp();

  runApp(
    // Riverpodã§ãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘æ¸¡ã—ã§ãã‚‹çŠ¶æ…‹ã«ã™ã‚‹
    ProviderScope(
      child: ChatApp(),
    ),
  );
}

class ChatApp extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      title: 'ChatApp',
      theme: ThemeData(
        primarySwatch: Colors.blue,
      ),
      home: LoginPage(),
    );
  }
}

// ConsumerWidgetã§Providerã‹ã‚‰å€¤ã‚’å—ã‘æ¸¡ã™
class LoginPage extends ConsumerWidget {
  @override
  Widget build(BuildContext context, ScopedReader watch) {
    // Providerã‹ã‚‰å€¤ã‚’å—ã‘å–ã‚‹
    final infoText = watch(infoTextProvider).state;
    final email = watch(emailProvider).state;
    final password = watch(passwordProvider).state;

    return Scaffold(
      body: Center(
        child: Container(
          padding: EdgeInsets.all(24),
          child: Column(
            mainAxisAlignment: MainAxisAlignment.center,
            children: <Widget>[
              TextFormField(
                decoration: InputDecoration(labelText: 'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹'),
                onChanged: (String value) {
                  // Providerã‹ã‚‰å€¤ã‚’æ›´æ–°
                  context.read(emailProvider).state = value;
                },
              ),
              TextFormField(
                decoration: InputDecoration(labelText: 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰'),
                obscureText: true,
                onChanged: (String value) {
                  // Providerã‹ã‚‰å€¤ã‚’æ›´æ–°
                  context.read(passwordProvider).state = value;
                },
              ),
              Container(
                padding: EdgeInsets.all(8),
                child: Text(infoText),
              ),
              Container(
                width: double.infinity,
                child: ElevatedButton(
                  child: Text('ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²'),
                  onPressed: () async {
                    try {
                      final FirebaseAuth auth = FirebaseAuth.instance;
                      final result = await auth.createUserWithEmailAndPassword(
                        email: email,
                        password: password,
                      );
                      // ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’æ›´æ–°
                      context.read(userProvider).state = result.user;

                      await Navigator.of(context).pushReplacement(
                        MaterialPageRoute(builder: (context) {
                          return ChatPage();
                        }),
                      );
                    } catch (e) {
                      // Providerã‹ã‚‰å€¤ã‚’æ›´æ–°
                      context.read(infoTextProvider).state =
                          "ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸï¼š${e.toString()}";
                    }
                  },
                ),
              ),
              const SizedBox(height: 8),
              Container(
                width: double.infinity,
                child: OutlinedButton(
                  child: Text('ãƒ­ã‚°ã‚¤ãƒ³'),
                  onPressed: () async {
                    try {
                      final FirebaseAuth auth = FirebaseAuth.instance;
                      await auth.signInWithEmailAndPassword(
                        email: email,
                        password: password,
                      );
                      await Navigator.of(context).pushReplacement(
                        MaterialPageRoute(builder: (context) {
                          return ChatPage();
                        }),
                      );
                    } catch (e) {
                      // Providerã‹ã‚‰å€¤ã‚’æ›´æ–°
                      context.read(infoTextProvider).state =
                          "ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸï¼š${e.toString()}";
                    }
                  },
                ),
              ),
            ],
          ),
        ),
      ),
    );
  }
}

// ConsumerWidgetã§Providerã‹ã‚‰å€¤ã‚’å—ã‘æ¸¡ã™
class ChatPage extends ConsumerWidget {
  @override
  Widget build(BuildContext context, ScopedReader watch) {
    // Providerã‹ã‚‰å€¤ã‚’å—ã‘å–ã‚‹
    final User user = watch(userProvider).state!;
    final AsyncValue<QuerySnapshot> asyncPostsQuery = watch(postsQueryProvider);

    return Scaffold(
      appBar: AppBar(
        title: Text('ãƒãƒ£ãƒƒãƒˆ'),
        actions: <Widget>[
          IconButton(
            icon: Icon(Icons.close),
            onPressed: () async {
              await FirebaseAuth.instance.signOut();
              await Navigator.of(context).pushReplacement(
                MaterialPageRoute(builder: (context) {
                  return LoginPage();
                }),
              );
            },
          ),
        ],
      ),
      body: Column(
        children: [
          Container(
            padding: EdgeInsets.all(8),
            child: Text('ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±ï¼š${user.email}'),
          ),
          Expanded(
            // StreamProviderã‹ã‚‰å—ã‘å–ã£ãŸå€¤ã¯ .when() ã§çŠ¶æ…‹ã«å¿œã˜ã¦å‡ºã—åˆ†ã‘ã§ãã‚‹
            child: asyncPostsQuery.when(
              // å€¤ãŒå–å¾—ã§ããŸã¨ã
              data: (QuerySnapshot query) {
                return ListView(
                  children: query.docs.map((document) {
                    return Card(
                      child: ListTile(
                        title: Text(document['text']),
                        subtitle: Text(document['email']),
                        trailing: document['email'] == user.email
                            ? IconButton(
                                icon: Icon(Icons.delete),
                                onPressed: () async {
                                  // æŠ•ç¨¿ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‰Šé™¤
                                  await FirebaseFirestore.instance
                                      .collection('posts')
                                      .doc(document.id)
                                      .delete();
                                },
                              )
                            : null,
                      ),
                    );
                  }).toList(),
                );
              },
              // å€¤ãŒèª­è¾¼ä¸­ã®ã¨ã
              loading: () {
                return Center(
                  child: Text('èª­è¾¼ä¸­...'),
                );
              },
              // å€¤ã®å–å¾—ã«å¤±æ•—ã—ãŸã¨ã
              error: (e, stackTrace) {
                return Center(
                  child: Text(e.toString()),
                );
              },
            ),
          ),
        ],
      ),
      floatingActionButton: FloatingActionButton(
        child: Icon(Icons.add),
        onPressed: () async {
          await Navigator.of(context).push(
            MaterialPageRoute(builder: (context) {
              return AddPostPage();
            }),
          );
        },
      ),
    );
  }
}

// ConsumerWidgetã§Providerã‹ã‚‰å€¤ã‚’å—ã‘æ¸¡ã™
class AddPostPage extends ConsumerWidget {
  @override
  Widget build(BuildContext context, ScopedReader watch) {
    // Providerã‹ã‚‰å€¤ã‚’å—ã‘å–ã‚‹
    final user = watch(userProvider).state!;
    final messageText = watch(messageTextProvider).state;

    return Scaffold(
      appBar: AppBar(
        title: Text('ãƒãƒ£ãƒƒãƒˆæŠ•ç¨¿'),
      ),
      body: Center(
        child: Container(
          padding: EdgeInsets.all(32),
          child: Column(
            mainAxisAlignment: MainAxisAlignment.center,
            children: <Widget>[
              TextFormField(
                decoration: InputDecoration(labelText: 'æŠ•ç¨¿ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸'),
                keyboardType: TextInputType.multiline,
                maxLines: 3,
                onChanged: (String value) {
                  // Providerã‹ã‚‰å€¤ã‚’æ›´æ–°
                  context.read(messageTextProvider).state = value;
                },
              ),
              const SizedBox(height: 8),
              Container(
                width: double.infinity,
                child: ElevatedButton(
                  child: Text('æŠ•ç¨¿'),
                  onPressed: () async {
                    final date = DateTime.now().toLocal().toIso8601String();
                    final email = user.email;
                    await FirebaseFirestore.instance
                        .collection('posts')
                        .doc()
                        .set({
                      'text': messageText,
                      'email': email,
                      'date': date
                    });
                    Navigator.of(context).pop();
                  },
                ),
              )
            ],
          ),
        ),
      ),
    );
  }
}
```


## Riverpodã‚’ä½¿ã£ãŸçŠ¶æ…‹ç®¡ç†

ãŠç–²ã‚Œã•ã¾ã§ã—ãŸã€‚  
ã“ã‚Œã§Riverpodã‚’ä½¿ã£ãŸçŠ¶æ…‹ç®¡ç†ã¯å®Œäº†ã§ã™ ğŸ‰ğŸ‰ğŸ‰

Providerã«ç¶šãRiverpodã§ã‚‚çŠ¶æ…‹ç®¡ç†ã‚’è¡Œã†ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã­ ğŸ‘


## å…¥é–€ Riverpod

ã‚ˆã‚Šè©³ã—ãRiverpodã‚’ä½¿ã£ãŸçŠ¶æ…‹ç®¡ç†ã‚’ç†è§£ã™ã‚‹ãŸã‚ã®æ›¸ç±ã‚’å…¬é–‹ã—ã¦ã„ã¾ã™ã®ã§ã€ã‚ˆã‹ã£ãŸã‚‰ã”åˆ©ç”¨ä¸‹ã•ã„ã€‚

- **å…¥é–€ Riverpod**
  - [Zenn](https://zenn.dev/umatoma/books/bd010486772aff)
  - [Amazon](https://www.amazon.co.jp/dp/B09754L28H/ref=nosim?tag=flt0c-22)

<p style="max-width: 320px;">
    <img src="/images/banner/book_riverpod_banner.png" />
</p>


## ã¾ã¨ã‚

- Riverpodã‚’ä½¿ã£ã¦çŠ¶æ…‹ç®¡ç†ãŒã§ãã‚‹

æ¬¡å›ã‹ã‚‰ã¯ã€ä»Šå›ä½œã£ãŸãƒãƒ£ãƒƒãƒˆã‚¢ãƒ—ãƒªã‚’Webã‚¢ãƒ—ãƒªã¨ã—ã¦å…¬é–‹ã™ã‚‹æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¦ã„ãã¾ã™ ğŸ’ªğŸ’ªğŸ’ª


## å‚è€ƒæƒ…å ±

- https://pub.dev/packages/provider
