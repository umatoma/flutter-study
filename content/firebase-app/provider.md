---
title: 'Providerã§çŠ¶æ…‹ç®¡ç†'
description: 'ãƒãƒ£ãƒƒãƒˆã‚¢ãƒ—ãƒªã§Providerã‚’ä½¿ã£ãŸçŠ¶æ…‹ç®¡ç†ã‚’å®Ÿè£…ã™ã‚‹æ–¹æ³•ã‚’ç´¹ä»‹'
slug: firebase-app-05
---

## ã“ã®ãƒšãƒ¼ã‚¸ã®ã‚´ãƒ¼ãƒ«

- Providerã®æ¦‚è¦ã¨ä½¿ã„æ–¹ã‚’çŸ¥ã‚‹
- Providerã‚’ä½¿ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’ç®¡ç†ã™ã‚‹


## ãƒãƒ£ãƒƒãƒˆã‚¢ãƒ—ãƒªå…¨ä½“åƒ

### æ©Ÿèƒ½ä¸€è¦§

- âœ¨ ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒ»ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§ãƒ­ã‚°ã‚¤ãƒ³ã§ãã‚‹
- âœ¨ ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã§ãã‚‹
- âœ¨ ãƒãƒ£ãƒƒãƒˆã®æŠ•ç¨¿ä¸€è¦§ã‚’è¡¨ç¤ºã§ãã‚‹
- âœ¨ ãƒãƒ£ãƒƒãƒˆã«æŠ•ç¨¿ã§ãã‚‹
- âœ¨ ãƒãƒ£ãƒƒãƒˆã®æŠ•ç¨¿ã‚’å‰Šé™¤ã§ãã‚‹

### ã‚¤ãƒ¡ãƒ¼ã‚¸å›³

![](/images/firebase-app/about-firebase-app.svg)

### â—ï¸ æ³¨æ„äº‹é … â—ï¸

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ»é››å½¢ã®ä½œæˆãŒçµ‚ã‚ã£ã¦ã„ãªã„å ´åˆã¯  
<aa href="/firebase-app/about-firebase-app">Firebaseã‚’ä½¿ã£ãŸã‚¢ãƒ—ãƒªæ¦‚è¦</aa>ã®ãƒšãƒ¼ã‚¸ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚


## çŠ¶æ…‹ç®¡ç†

### çŠ¶æ…‹ç®¡ç†ã¨ã¯

ã¾ãšã¯çŠ¶æ…‹ç®¡ç†ã¨ã¯ä½•ã§ã‚ã‚‹ã‹ã«ã¤ã„ã¦ç†è§£ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

<aa href="/widgets/about-widget">Widgetã¨ã¯</aa>ã§ã¯ã€  
Flutterã¯**Widgetã‚’ãƒ„ãƒªãƒ¼çŠ¶ã«çµ„ã¿åˆã‚ã›UIã‚’å®Ÿç¾**ã™ã‚‹ã“ã¨ã‚’ç´¹ä»‹ã—ã¾ã—ãŸã­ã€‚

ãã—ã¦ã€<aa href="/widgets/state-widget">çŠ¶æ…‹ã‚’æŒã£ãŸWidget</aa>ã§ã¯ã€  
**ãƒ‡ãƒ¼ã‚¿ã‚’å…ƒã«UIã‚’ä½œã‚‹**ä»•çµ„ã¿ã®ã“ã¨ã‚’**çŠ¶æ…‹ã‚’æŒã¤**ã¨å‘¼ã¶ã“ã¨ã‚’ç´¹ä»‹ã—ã¾ã—ãŸã­ã€‚


<table>
    <thead>
        <tr>
            <th>Widgetã‚’ãƒ„ãƒªãƒ¼çŠ¶ã«çµ„ã¿åˆã‚ã›UIã‚’å®Ÿç¾</th>
            <th>ãƒ‡ãƒ¼ã‚¿ã‚’å…ƒã«UIã‚’ä½œã‚‹</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td width="40%"><img src="/images/about-widget.svg" /></td>
            <td width="60%"><img src="/images/state-widget.svg" /></td>
        </tr>
    </tbody>
</table>


ã“ã‚Œã‚‰ã®çŸ¥è­˜ã‚’çµ„ã¿åˆã‚ã›ã‚‹ã¨ã€  
**æ§˜ã€…ãªãƒ‡ãƒ¼ã‚¿ã‚’å…ƒã«ã‚¢ãƒ—ãƒªã®UIã‚’ä½œã£ã¦ã„ã‚‹**ã®ã§ã™ã€‚

**æ§˜ã€…ãªãƒ‡ãƒ¼ã‚¿**ã®ã“ã¨ã‚’**ã‚¢ãƒ—ãƒªã®çŠ¶æ…‹**ã¨å‘¼ã³ã€  
ãã®**çŠ¶æ…‹ã‚’æ‰±ã„ã‚„ã™ãç®¡ç†ã™ã‚‹ä»•çµ„ã¿**ã®ã“ã¨ã‚’**çŠ¶æ…‹ç®¡ç†**ã¨è¨€ã†ã®ã§ã™ã€‚

çŠ¶æ…‹ç®¡ç†ã‚’è¡Œã£ã¦ã„ãªã„ã¨ãƒ‡ãƒ¼ã‚¿ã®æ‰±ã„ãŒè¤‡é›‘ã«ãªã‚Šã€  
ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’æ›¸ãã®ãŒå¤§å¤‰ã«ãªã£ã¦ã—ã¾ã†ã§ã—ã‚‡ã† ğŸ˜¨ğŸ˜¨ğŸ˜¨

![](/images/provider/app-state.svg)


### Provider

<aa href="/widgets/state-widget">çŠ¶æ…‹ã‚’æŒã£ãŸWidget</aa>ã§ã‚‚ç´¹ä»‹ã—ãŸã‚ˆã†ã«ã€  
`StatefulWidget` ã¨ `State` ã‚’ä½¿ãˆã°çŠ¶æ…‹ã‚’å…ƒã«UIã‚’ä½œã‚‹ã“ã¨ã¯å¯èƒ½ã§ã™ã€‚

ã§ã™ãŒã€æ§˜ã€…ãªWidgetãŒçµ„ã¿åˆã‚ã•ã£ãŸUIã«ãªã‚Šã€  
**çŠ¶æ…‹ãŒè¤‡é›‘ã«ãªã£ã¦ã—ã¾ã†ã¨ã€ç®¡ç†ã—ãã‚Œãªããªã£ã¦ã—ã¾ã†**ã®ã§ã™ã€‚

ãã“ã§ã€ç™»å ´ã™ã‚‹ã®ãŒ `provider` ã§ã™ã€‚

- https://pub.dev/packages/provider

ã“ã‚Œã‚’ä½¿ã†ã“ã¨ã§**è¤‡é›‘ãªçŠ¶æ…‹ã‚‚ç°¡å˜ã«ç®¡ç†ã™ã‚‹ã“ã¨ãŒã§ãã‚‹**ã®ã§ã™ã€‚


## Providerã®ä½¿ã„æ–¹

æ¬¡ã¯ã€Providerã®åŸºæœ¬çš„ãªä½¿ã„æ–¹ã‚’ç´¹ä»‹ã—ã¦ã„ãã¾ã™ã€‚

### Providerã§å‡ºæ¥ã‚‹ã“ã¨

ã§ã¯ã€Providerã‚’ä½¿ã†ã¨å…·ä½“çš„ã«ã¯ä½•ãŒå‡ºæ¥ã‚‹ã®ã§ã—ã‚‡ã†ã‹ï¼Ÿ

ã¨ã¦ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ã§**è¦ªWidgetã‹ã‚‰å­Widgetã«ãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘æ¸¡ã™**ã“ã¨ãŒå‡ºæ¥ã‚‹ã®ã§ã™ã€‚  
ãƒ‡ãƒ¼ã‚¿ã‚’æ¸¡ã™å…ˆã¯ã€**å­Widgetã§ã‚ã‚Œã°ä½•å‡¦ã§ã‚‚OK**ã§ã™ã€‚

![](/images/provider/provider-state.svg)

### ãƒ‡ãƒ¼ã‚¿ã®å—ã‘æ¸¡ã—

Providerã®åŸºæœ¬çš„ãªãƒ‡ãƒ¼ã‚¿ã®å—ã‘æ¸¡ã—æ–¹æ³•ã‚’ç¢ºèªã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚  
ä½¿ã„æ–¹ã¯ç°¡å˜ã§ã€è¦ªWidgetã¨å­Widgetã§ãƒ‡ãƒ¼ã‚¿ã®å—ã‘æ¸¡ã—ç”¨ã®å‡¦ç†ã‚’è¿½åŠ ã™ã‚‹ã ã‘ã§è‰¯ã„ã®ã§ã™ã€‚

è§£èª¬

- è¦ªWidgetã§ `Provider<T>.value()` ã‚’ä½¿ã„**ãƒ‡ãƒ¼ã‚¿ã‚’æ¸¡ã™**
- å­Widgetã§ `Provider.of<T>()` ã‚’ä½¿ã„**ãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚‹**

ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰

```dart
// ChangeNotifierã‚’ç¶™æ‰¿ã™ã‚‹ã¨å¤‰æ›´å¯èƒ½ãªãƒ‡ãƒ¼ã‚¿ã‚’æ¸¡ã›ã‚‹
class CountData {
  int count = 0;
}

class ParentWidget extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    // Provider<T>() ã§å­Widgetã«ãƒ‡ãƒ¼ã‚¿ã‚’æ¸¡ã™
    // â€» æ¸¡ã™ãƒ‡ãƒ¼ã‚¿ã® ã‚¯ãƒ©ã‚¹ ã¨ <T> ã¯æƒãˆã¾ã—ã‚‡ã†
    return Provider<CountData>.value(
      // æ¸¡ã™ãƒ‡ãƒ¼ã‚¿
      create: (context) => CountData(),
      child: Container(
        child: ChildWidget(),
      ),
    );
  }
}

class ChildWidget extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    // Provider.of<T>(context) ã§è¦ªWidgetã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚‹
    // â€» å—ã‘å–ã‚‹ãƒ‡ãƒ¼ã‚¿ã® ã‚¯ãƒ©ã‚¹ ã¨ <T> ã¯æƒãˆã¾ã—ã‚‡ã†
    final CountData data = Provider.of<CountData>(context);

    return Column(
      children: <Widget>[
        // å—ã‘å–ã£ãŸãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ã„UIä½œæˆ
        Text('count is ${data.count.toString()}'),
      ],
    );
  }
}
```

### å—ã‘æ¸¡ã™ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ã™ã‚‹

å—ã‘æ¸¡ã™ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ã™ã‚‹æ–¹æ³•ã‚‚ç¢ºèªã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

ã“ã¡ã‚‰ã‚‚é›£ã—ã„ã“ã¨ã¯ãªãã€  
`ChangeNotifier` ã‚’ç¶™æ‰¿ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’ `ChangeNotifierProvider` ã‚’ä½¿ã£ã¦æ¸¡ã›ã°è‰¯ã„ã®ã§ã™ã€‚

è§£èª¬

- å—ã‘æ¸¡ã™ãƒ‡ãƒ¼ã‚¿ã¯ `ChangeNotifier` ã‚’ç¶™æ‰¿ã— `notifyListeners()` ã‚’ä½¿ã£ã¦å¤‰æ›´ã‚’çŸ¥ã‚‰ã›ã‚‹
- `ChangeNotifierProvider` ã‚’ä½¿ã£ã¦ãƒ‡ãƒ¼ã‚¿ã‚’æ¸¡ã™

ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰

```dart
// ChangeNotifierã‚’ç¶™æ‰¿ã™ã‚‹ã¨å¤‰æ›´å¯èƒ½ãªãƒ‡ãƒ¼ã‚¿ã‚’æ¸¡ã›ã‚‹
class CountData extends ChangeNotifier {
  int count = 0;

  void increment() {
    count = count + 1;
    // å€¤ãŒå¤‰æ›´ã—ãŸã“ã¨ã‚’çŸ¥ã‚‰ã›ã‚‹
    //  >> UIã‚’å†æ§‹ç¯‰ã™ã‚‹
    notifyListeners();
  }
}

class ParentWidget extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    // Provider<T>() ã§å­Widgetã«ãƒ‡ãƒ¼ã‚¿ã‚’æ¸¡ã™
    // â€» æ¸¡ã™ãƒ‡ãƒ¼ã‚¿ã® ã‚¯ãƒ©ã‚¹ ã¨ <T> ã¯æƒãˆã¾ã—ã‚‡ã†
    return ChangeNotifierProvider<CountData>(
      // æ¸¡ã™ãƒ‡ãƒ¼ã‚¿
      create: (context) => CountData(),
      child: Container(
        child: ChildWidget(),
      ),
    );
  }
}

class ChildWidget extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    // Provider.of<T>(context) ã§è¦ªWidgetã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚‹
    // â€» å—ã‘å–ã‚‹ãƒ‡ãƒ¼ã‚¿ã® ã‚¯ãƒ©ã‚¹ ã¨ <T> ã¯æƒãˆã¾ã—ã‚‡ã†
    final CountData data = Provider.of<CountData>(context);

    return Column(
      children: <Widget>[
        // å—ã‘å–ã£ãŸãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ã„UIä½œæˆ
        Text('count is ${data.count.toString()}'),
        ElevatedButton(
          child: Text('Increment'),
          onPressed: () {
            // ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°
            data.increment();
          },
        ),
      ],
    );
  }
}
```


## Providerã§ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’ç®¡ç†ã™ã‚‹

Providerã®ä»•çµ„ã¿ã‚„ä½¿ã„æ–¹ã¯ç†è§£ã§ããŸã§ã—ã‚‡ã†ã‹ ğŸ¤”  
ãã‚Œã§ã¯ã€Providerã‚’ä½¿ã„ãƒãƒ£ãƒƒãƒˆã‚¢ãƒ—ãƒªã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’ç®¡ç†ã—ã¦ã¿ã¾ã—ã‚‡ã† ğŸ’ª

### Providerã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

Providerã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã—ã‚‡ã†ã€‚

- https://pub.dev/packages/provider

ä½œæˆã—ãŸFlutterãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã® `pubspec.yaml` ã‚’é–‹ãã€  
`dependencies` ã«ä½¿ç”¨ã™ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’è¿½è¨˜ã—ã¾ã™ã€‚

```yaml
# --- çœç•¥ ---

dependencies:
  flutter:
    sdk: flutter
  cupertino_icons: ^1.0.3
  firebase_core: ^1.0.1
  firebase_auth: ^1.0.1
  cloud_firestore: ^1.0.1
  # *** ã“ã“ã‚’è¿½è¨˜ ***
  provider: ^5.0.0

dev_dependencies:
  flutter_test:
    sdk: flutter

# --- çœç•¥ ---
```

VSCodeã®Flutterãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½¿ã£ã¦ã„ã‚‹å ´åˆã¯ã€  
ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ã™ã‚Œã° `pubspec.yaml` ã‚’å…ƒã«è‡ªå‹•çš„ã«ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãã‚Œã‚‹ã¯ãšã§ã™ã€‚

ã‚‚ã—ã€ä¸Šæ‰‹ãã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãã‚Œãªã„å ´åˆã¯ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ã‚‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã¾ã™ã€‚

```bash
$ flutter pub get
```

### ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’ç®¡ç†ã™ã‚‹

ã‚ã¨å°‘ã—ã§ã™ã€é ‘å¼µã£ã¦ã„ãã¾ã—ã‚‡ã† ğŸ’ª

Providerã‚’ä½¿ã£ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®å—ã‘æ¸¡ã—ã‚’è¡Œã„ã¾ã—ã‚‡ã†ã€‚  
`lib/main.dart` ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«æ›¸ãæ›ãˆã¾ã—ã‚‡ã†ã€‚

è§£èª¬

- `ChangeNotifierProvider<UserState>.value()` ã‚’ä½¿ã„å¤‰æ›´å¯èƒ½ãªãƒ‡ãƒ¼ã‚¿ã‚’æ¸¡ã™
- `Provider.of<UserState>()` ã§ãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚‹
- å¼•æ•°ã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’æ¸¡ã™å‡¦ç†ãŒä¸è¦ã«ãªã£ãŸ ğŸ¤©

ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰

```dart
import 'package:cloud_firestore/cloud_firestore.dart';
import 'package:firebase_auth/firebase_auth.dart';
import 'package:flutter/material.dart';
import 'package:provider/provider.dart';

// æ›´æ–°å¯èƒ½ãªãƒ‡ãƒ¼ã‚¿
class UserState extends ChangeNotifier {
  User? user;

  void setUser(User newUser) {
    user = newUser;
    notifyListeners();
  }
}

void main() {
  // æœ€åˆã«è¡¨ç¤ºã™ã‚‹Widget
  runApp(ChatApp());
}

class ChatApp extends StatelessWidget {
  // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æƒ…å ±ã‚’ç®¡ç†ã™ã‚‹ãƒ‡ãƒ¼ã‚¿
  final UserState userState = UserState();

  @override
  Widget build(BuildContext context) {
    return ChangeNotifierProvider<UserState>(
      create: (context) => UserState(),
      child: MaterialApp( /* --- çœç•¥ --- */ ),
    );
  }
}

// ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ç”¨Widget
class LoginPage extends StatefulWidget {
  @override
  _LoginPageState createState() => _LoginPageState();
}

class _LoginPageState extends State<LoginPage> {
  
  /* --- çœç•¥ --- */

  @override
  Widget build(BuildContext context) {
    // ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å—ã‘å–ã‚‹
    final UserState userState = Provider.of<UserState>(context);

    return Scaffold(
      body: Center(
        child: Container(
          padding: EdgeInsets.all(24),
          child: Column(
            mainAxisAlignment: MainAxisAlignment.center,
            children: <Widget>[
              /* --- çœç•¥ --- */
              Container(
                width: double.infinity,
                // ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ãƒœã‚¿ãƒ³
                child: ElevatedButton(
                  child: Text('ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²'),
                  onPressed: () async {
                    try {
                      // ãƒ¡ãƒ¼ãƒ«/ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²
                      final FirebaseAuth auth = FirebaseAuth.instance;
                      final result = await auth.createUserWithEmailAndPassword(
                        email: email,
                        password: password,
                      );
                      // ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’æ›´æ–°
                      userState.setUser(result.user!);
                      // ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ã«æˆåŠŸã—ãŸå ´åˆ
                      // ãƒãƒ£ãƒƒãƒˆç”»é¢ã«é·ç§»ï¼‹ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã‚’ç ´æ£„
                      await Navigator.of(context).pushReplacement(
                        MaterialPageRoute(builder: (context) {
                          return ChatPage();
                        }),
                      );
                    } catch (e) {
                      /* --- çœç•¥ --- */
                    }
                  },
                ),
              ),
              const SizedBox(height: 8),
              Container(
                width: double.infinity,
                // ãƒ­ã‚°ã‚¤ãƒ³ç™»éŒ²ãƒœã‚¿ãƒ³
                child: OutlinedButton(
                  child: Text('ãƒ­ã‚°ã‚¤ãƒ³'),
                  onPressed: () async {
                    try {
                      // ãƒ¡ãƒ¼ãƒ«/ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§ãƒ­ã‚°ã‚¤ãƒ³
                      final FirebaseAuth auth = FirebaseAuth.instance;
                      final result = await auth.signInWithEmailAndPassword(
                        email: email,
                        password: password,
                      );
                      // ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’æ›´æ–°
                      userState.setUser(result.user!);
                      // ãƒ­ã‚°ã‚¤ãƒ³ã«æˆåŠŸã—ãŸå ´åˆ
                      // ãƒãƒ£ãƒƒãƒˆç”»é¢ã«é·ç§»ï¼‹ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã‚’ç ´æ£„
                      await Navigator.of(context).pushReplacement(
                        MaterialPageRoute(builder: (context) {
                          return ChatPage();
                        }),
                      );
                    } catch (e) {
                      /* --- çœç•¥ --- */
                    }
                  },
                ),
              ),
            ],
          ),
        ),
      ),
    );
  }
}

// ãƒãƒ£ãƒƒãƒˆç”»é¢ç”¨Widget
class ChatPage extends StatelessWidget {
  ChatPage();

  @override
  Widget build(BuildContext context) {
    // ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å—ã‘å–ã‚‹
    final UserState userState = Provider.of<UserState>(context);
    final User user = userState.user!;

    return Scaffold(
      /* --- çœç•¥ --- */
      body: Column(
        children: [
          Container(
            padding: EdgeInsets.all(8),
            child: Text('ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±ï¼š${user.email}'),
          ),
          Expanded(
            // Stream
            // éåŒæœŸå‡¦ç†ã®çµæœã‚’å…ƒã«Widgetã‚’ä½œã‚Œã‚‹
            child: StreamBuilder<QuerySnapshot>(
              // æŠ•ç¨¿ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä¸€è¦§ã‚’å–å¾—ï¼ˆéåŒæœŸå‡¦ç†ï¼‰
              // æŠ•ç¨¿æ—¥æ™‚ã§ã‚½ãƒ¼ãƒˆ
              stream: FirebaseFirestore.instance
                  .collection('posts')
                  .orderBy('date')
                  .snapshots(),
              builder: (context, snapshot) {
                // ãƒ‡ãƒ¼ã‚¿ãŒå–å¾—ã§ããŸå ´åˆ
                if (snapshot.hasData) {
                  final List<DocumentSnapshot> documents = snapshot.data!.docs;
                  // å–å¾—ã—ãŸæŠ•ç¨¿ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä¸€è¦§ã‚’å…ƒã«ãƒªã‚¹ãƒˆè¡¨ç¤º
                  return ListView(
                    children: documents.map((document) {
                      return Card(
                        child: ListTile(
                          title: Text(document['text']),
                          subtitle: Text(document['email']),
                          // è‡ªåˆ†ã®æŠ•ç¨¿ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å ´åˆã¯å‰Šé™¤ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
                          trailing: document['email'] == user.email
                              ? IconButton(
                                  icon: Icon(Icons.delete),
                                  onPressed: () async {
                                    // æŠ•ç¨¿ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‰Šé™¤
                                    await FirebaseFirestore.instance
                                        .collection('posts')
                                        .doc(document.id)
                                        .delete();
                                  },
                                )
                              : null,
                        ),
                      );
                    }).toList(),
                  );
                }
                /* --- çœç•¥ --- */
              },
            ),
          ),
        ],
      ),
      floatingActionButton: FloatingActionButton(
        child: Icon(Icons.add),
        onPressed: () async {
          // æŠ•ç¨¿ç”»é¢ã«é·ç§»
          await Navigator.of(context).push(
            MaterialPageRoute(builder: (context) {
              return AddPostPage();
            }),
          );
        },
      ),
    );
  }
}

// æŠ•ç¨¿ç”»é¢ç”¨Widget
class AddPostPage extends StatefulWidget {
  AddPostPage();

  @override
  _AddPostPageState createState() => _AddPostPageState();
}

class _AddPostPageState extends State<AddPostPage> {
  
  /* --- çœç•¥ --- */

  @override
  Widget build(BuildContext context) {
    // ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å—ã‘å–ã‚‹
    final UserState userState = Provider.of<UserState>(context);
    final User user = userState.user!;

    return Scaffold(
      appBar: AppBar(
        title: Text('ãƒãƒ£ãƒƒãƒˆæŠ•ç¨¿'),
      ),
      body: Center(
        child: Container(
          padding: EdgeInsets.all(32),
          child: Column(
            mainAxisAlignment: MainAxisAlignment.center,
            children: <Widget>[
              /* --- çœç•¥ --- */
              Container(
                width: double.infinity,
                child: ElevatedButton(
                  child: Text('æŠ•ç¨¿'),
                  onPressed: () async {
                    final date =
                        DateTime.now().toLocal().toIso8601String(); // ç¾åœ¨ã®æ—¥æ™‚
                    final email = user.email; // AddPostPage ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‚ç…§
                    // æŠ•ç¨¿ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆ
                    await FirebaseFirestore.instance
                        .collection('posts') // ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³IDæŒ‡å®š
                        .doc() // ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆIDè‡ªå‹•ç”Ÿæˆ
                        .set({
                      'text': messageText,
                      'email': email,
                      'date': date
                    });
                    // 1ã¤å‰ã®ç”»é¢ã«æˆ»ã‚‹
                    Navigator.of(context).pop();
                  },
                ),
              )
            ],
          ),
        ),
      ),
    );
  }
}

```


## ãƒãƒ£ãƒƒãƒˆã‚¢ãƒ—ãƒªå®Œæˆ

ãŠç–²ã‚Œã•ã¾ã§ã—ãŸã€‚  
ã“ã‚Œã§ãƒãƒ£ãƒƒãƒˆã‚¢ãƒ—ãƒªã®å®Œæˆã§ã™ ğŸ‰ğŸ‰ğŸ‰

Firebaseã‚„Providerã‚’ä½¿ã£ãŸã€  
å°‘ã—ãªè¤‡é›‘ãªã‚¢ãƒ—ãƒªã‚’ä½œã‚Šä¸Šã’ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã­ ğŸ‘

æœ¬æ ¼çš„ãªã‚¢ãƒ—ãƒªã‚’ä½œã‚‹ä¸Šã§ã®å¤§åˆ‡ãªè¦ç´ ã‚’çŸ¥ã‚‹ã“ã¨ãŒã§ããŸã¨æ€ã„ã¾ã™ã€‚

- Authenticationã‚’ä½¿ã£ãŸãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½
- Firestoreã‚’ä½¿ã£ãŸãƒ‡ãƒ¼ã‚¿ç®¡ç†
- Providerã‚’ä½¿ã£ãŸçŠ¶æ…‹ç®¡ç†

ã“ã®ä»–ã«ã‚‚ã€Googleãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½ã‚„ãƒãƒ£ãƒƒãƒˆãƒ«ãƒ¼ãƒ ä½œæˆæ©Ÿèƒ½ã‚’ä»˜ã‘è¶³ã—ã¦ã¿ã¦ã‚‚ã‚‰ãˆã‚‹ã¨  
æ›´ã«ç†è§£ãŒæ·±ã¾ã‚‹ã®ã§ã€ãœã²ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã—ã¦è¦‹ã¦ä¸‹ã•ã„ ğŸ’ªğŸ’ªğŸ’ª

### ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰

å…¨ä½“ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèªã—ãŸã„æ™‚ã¯ [ã“ã¡ã‚‰](https://gist.github.com/umatoma/59e2bc2f70c94917f817d9cfedca897e) ã‹ã‚‰ã©ã†ãã€‚ 


## ä½œã£ã¦å­¦ã¶ã€Flutterã¨Firebaseã‚’ä½¿ã£ãŸã‚¢ãƒ—ãƒªé–‹ç™º

Flutterã¨Firebaseã‚’ä½¿ã£ãŸã‚¢ãƒ—ãƒªé–‹ç™ºã‚’ã€ã•ã‚‰ã«ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ã™ã‚‹ãŸã‚ã®æ›¸ç±ã‚’å…¬é–‹ã—ã¦ã„ã¾ã™ã®ã§ã€ã‚ˆã‹ã£ãŸã‚‰ã”åˆ©ç”¨ä¸‹ã•ã„ã€‚

- **ä½œã£ã¦å­¦ã¶ã€Flutterã¨Firebaseã‚’ä½¿ã£ãŸã‚¢ãƒ—ãƒªé–‹ç™º**
  - [Zenn](https://zenn.dev/umatoma/books/1f4cb2404f3fa9)
  - [Amazon](https://www.amazon.co.jp/dp/B096T3YMZ3/ref=nosim?tag=flt0c-22)

<p style="max-width: 320px;">
    <img src="/images/banner/book_banner.png" />
</p>


## ã¾ã¨ã‚

- Providerã‚’ä½¿ã†ã¨çŠ¶æ…‹ç®¡ç†ãŒã§ãã‚‹
- ãƒãƒ£ãƒƒãƒˆã‚¢ãƒ—ãƒªå®Œæˆ
- æ©Ÿèƒ½è¿½åŠ ã«ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã—ã¦ã¿ã‚‹ã¨ç†è§£ãŒæ·±ã¾ã‚‹

æ¬¡ã¯ã€Riverpodã¨ã„ã†ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ã£ãŸå ´åˆã®çŠ¶æ…‹ç®¡ç†ã‚‚è©¦ã—ã¦ã¿ã¾ã™ ğŸ’ª


## å‚è€ƒæƒ…å ±

- https://pub.dev/packages/provider
